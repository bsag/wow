<section class="post-comments flex flex-column mv2">
  <h3 class="f4 f3-ns lh-title">Comments</h3>

  {{ $comments := readDir "data/comments" }}
  {{ $.Scratch.Add "hasComments" 0 }}
  {{ $entryId := .UniqueID }}

  {{ range $comments }}
    {{ if eq .Name $entryId }}
      {{ $.Scratch.Add "hasComments" 1 }}
      {{ range $index, $comments := (index $.Site.Data.comments $entryId ) }}
        <div class="post-comment mt3">
          <div class="post-comment-header">
            <img class="post-comment-avatar" src="https://www.gravatar.com/avatar/{{ .email }}?s=100">
            <p class="post-comment-info"><strong>{{ .name }}</strong><br>{{ dateFormat "02/01/2006" .date }}</p>
          </div>
          {{ .body | markdownify }}
        </div>
      {{ end }}       
    {{ end }}
  {{ end }}

  {{ if eq ($.Scratch.Get "hasComments") 0 }}
    <p>Nothing yet.</p>
  {{ end }}

  <h3 class="f4 f3-ns lh-title">Make a comment</h3>

    <form class="post-new-comment" method="POST" action="https://dev.staticman.net/v2/entry/eduardoboucas/hugo-plus-staticman/master/comments" accept-charset="utf-8">
      <!--form class="post-new-comment" method="POST" action="http://localhost:8055/v2/entry/eduardoboucas/staticman-test/master/comments"-->
      <fieldset id="comment_submission" class="ba b--transparent ph0 mh0">
        <input type="hidden" name="options[redirect]" value="{{ .Permalink }}#comment-submitted">
        <input type="hidden" name="options[entryId]" value="{{ .UniqueID }}">
        <legend class="ph0 mh0 fw6 clip">Email</legend>
        <div class="mt3">
          <label class="db lh-copy f6 b" for="name">Name</label>
          <input class="pa2 input-reset ba bg-transparent w-100 measure" name="fields[name]" type="text" class="post-comment-field" id="name">
        </div>
        <div class="mt3">
          <label class="db lh-copy f6 b" for="email-address">Email address</label>
          <input class="pa2 input-reset ba bg-transparent w-100 measure" type="email" name="fields[email]" class="post-comment-field" id="email-address">
        </div>
        <div class="mt3">
          <label class="db lh-copy f6 b" for="comment">Your message</label>
          <textarea name="fields[body]" class="post-comment-field pa2 input-reset ba bg-transparent w-100 measure" placeholder="Feel free to use Markdown." id="comment" rows="10"></textarea>
        </div>
      </fieldset>
      <div class="mt3">
        <input class="post-comment-field ph3 pv2 input-reset ba bw1 br2 b--near-black bg-transparent grow pointer f6 ttu tracked" type="submit" value="Submit">
      </div>
    </form>
</section>

<div id="comment-submitted" class="dialog">
<h3>Thank you</h3>
  <p>Your comment has been submitted and will be published once it has been approved.</p>
  <p><a href="https://github.com/eduardoboucas/hugo-plus-staticman/pulls">Click here</a> to see the pull request you generated.</p>
  
  <p><a href="#" class="link white bg-teal br2 pv1 ph2 tracked">OK</a></p>
</div>